#
# ---------------------------------------------------------------------------
#                      –°–∫—Ä–∏–ø—Ç –±–æ—Ç–∞ –¥–ª—è –ø–µ—Ä–µ—Å—ã–ª–∫–∏ –°–ú–°
#                           –ê–≤—Ç–æ—Ä: –ê–Ω—Ç–æ–Ω –°—Ç–µ–ø–∞–Ω–æ–≤
#                          –í–µ—Ä—Å–∏—è: 1.04 (ProxyLab)
#                             –î–∞—Ç–∞: 2024-12-05
# ---------------------------------------------------------------------------
# –û–ø–∏—Å–∞–Ω–∏–µ:
#    –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Telegram-–±–æ—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π
#    –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç –°–ú–° –∏–∑ –≥—Ä—É–ø–ø—ã '–û–±—â–∏–π –∫–∞–Ω–∞–ª –°–ú–°', –Ω–∞—Ö–æ–¥—è—â–µ–π—Å—è –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º
#    –±–æ—Ç–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ Remote Bot.
# ---------------------------------------------------------------------------
#


import telebot

"""
–ö–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∏–∑ —Ñ–∞–π–ª–∞, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª—É—á–∞–π –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ñ–∞–π–ª–∞ 
–∏ —Å–æ–∑–¥–∞–µ—Ç –æ–±—ä–µ–∫—Ç –±–æ—Ç–∞ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç—ã.
–¢–æ–∫–µ–Ω –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –Ω–æ–º–µ—Ä—É QIWI1.

–ò—Å–∫–ª—é—á–µ–Ω–∏–µ FileNotFoundError –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞.
–ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω, –≤—ã–≤–æ–¥–∏—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ.
"""

try:
    with open("token.conf", "r", encoding="utf-8") as token_file:
        token = token_file.read()
    with open("token.conf.backup", "w", encoding="utf-8") as token_backup_file:
        token_backup_file.write(token)
except FileNotFoundError:
    print("–§–∞–π–ª token.conf –Ω–µ –Ω–∞–π–¥–µ–Ω.")
bot = telebot.TeleBot(token)


@bot.message_handler(commands=["start"])
def start(message, res=False):
    """
    –§—É–Ω–∫—Ü–∏—è @bot.message_handler –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—É `/start`, –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    –∏ –¥–∞–µ—Ç –µ–º—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–º, –∫–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Å–ø—Ä–∞–≤–∫—É –æ —Ä–∞–±–æ—Ç–µ –±–æ—Ç–∞.
    """
    bot.send_message(
        message.chat.id,
        f"–ü—Ä–∏–≤–µ—Ç, <b>{message.from_user.first_name}</b>. –Ø –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏ –°–ú–°ü§ñ",
        parse_mode="html",
    )
    bot.send_message(
        message.chat.id,
        "–ß—Ç–æ–±—ã –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å —Ä–∞–±–æ—Ç–æ–π —Å–æ –º–Ω–æ–π, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∑–∞ —Å–ø—Ä–∞–≤–∫–æ–π –≤ <b>Notion</b>",
        parse_mode="html",
    )


@bot.message_handler(content_types=["text"])
def handle_text(message):
    """
    –§—É–Ω–∫—Ü–∏—è @bot.message_handler –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è,
    –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å –∏—Ö –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–µ —á–∞—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ —Ñ–∞–π–ª–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    –∏ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è, —á—Ç–æ–±—ã –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Ñ–∞–π–ª–æ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
    –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.
    """
    try:
        with open("settings.conf", "r", encoding="utf-8") as conf:
            chat_id = []
            filters = []

            for line in conf:
                line = line.strip()
                pos = line.find(":")

                if pos != -1:
                    chat_id.append(line[:pos])
                    filters.append(line[pos + 1 :])
    except FileNotFoundError:
        bot.send_message(
            message.chat.id,
            "‚ùóÔ∏è–§–∞–π–ª <b>`settings.conf`</b> –Ω–µ –Ω–∞–π–¥–µ–Ω",
            parse_mode="html",
        )
    for i, chat in enumerate(chat_id):
        if filters[i] in message.text:
            try:
                bot.send_message(chat, message.text)
            except Exception:
                print(f"–ß–∞—Ç —Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º {chat} –Ω–µ –Ω–∞–π–¥–µ–Ω")
    if (
        (message.text.find(":") != -1)
        and (message.text[-1] != ":")
        and (message.text.find("–ü—Ä–∏—à–ª–æ –°–ú–°") == -1)
        and (message.text.find("–ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–π –≤—ã–∑–æ–≤") == -1)
    ):
        try:
            with open("settings.conf", "a+", encoding="utf-8") as conf:
                conf.write("\n" + message.text)
                conf.seek(0)

                with open(
                    "settings.conf.backup", "w", encoding="utf-8"
                ) as settings_backup:
                    settings_backup.writelines(conf.readlines())
            bot.send_message(message.chat.id, "‚úÖ–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞")
        except FileNotFoundError:
            bot.send_message(
                message.chat.id,
                "‚ùóÔ∏è–§–∞–π–ª <b>`settings.conf`</b> –Ω–µ –Ω–∞–π–¥–µ–Ω",
                parse_mode="html",
            )
    elif message.text[-1] == ":":
        bot.send_message(message.chat.id, "‚ùóÔ∏è–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–∏–¥ –∫–æ–º–∞–Ω–¥—ã")


"""
–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –≤ —Ä–∞–±–æ—Ç—É, –æ–ø—Ä–æ—Å —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.
–ü–∞—Ä–∞–º–µ—Ç—Ä—ã none_stop –∏ interval –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—Ç –ø–æ—Å—Ç–æ—è–Ω—Å—Ç–≤–æ —Ä–∞–±–æ—Ç—ã –∏ –∑–∞–¥–µ—Ä–∂–∫—É –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏.
"""
bot.polling(none_stop=True, interval=0)
